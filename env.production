# Configurações de Produção para NioChat (sem Docker)
# Copie este arquivo para .env na VPS e configure as variáveis

# Django Settings
SECRET_KEY=your-super-secret-key-here-change-this-in-production
DEBUG=False
ALLOWED_HOSTS=api.niochat.com.br,admin.niochat.com.br,app.niochat.com.br,194.238.25.164,localhost,127.0.0.1

# Database
POSTGRES_PASSWORD=your-secure-postgres-password-here
DATABASE_URL=postgresql://niochat_user:${POSTGRES_PASSWORD}@localhost:5432/niochat

# Redis - ESSENCIAL para memória de conversas e IA (updated to port 6380)
REDIS_URL=redis://:E0sJT3wAYFuahovmHkxgy@154.38.176.17:6380/0
REDIS_HOST=154.38.176.17
REDIS_PORT=6380
REDIS_DB=0
REDIS_PASSWORD=E0sJT3wAYFuahovmHkxgy

# Redis para IA e memória de conversas
REDIS_AI_DB=1
REDIS_CONVERSATION_DB=2
REDIS_CACHE_DB=3

# Celery Settings (usando RabbitMQ como broker)
CELERY_BROKER_URL=amqp://admin:72e7d90895d04af7a4667efa5152b302@154.38.176.17:5672
CELERY_RESULT_BACKEND=redis://:E0sJT3wAYFuahovmHkxgy@154.38.176.17:6380/0
CELERY_RESULT_EXPIRES=300
CELERY_TASK_IGNORE_RESULT=False
CELERY_WORKER_CONCURRENCY=2
CELERY_MAX_TASKS_PER_CHILD=1000
CELERY_TASK_TIME_LIMIT=3600

# Email Configuration
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend

# File Upload
MEDIA_URL=/media/
STATIC_URL=/static/
MEDIA_ROOT=/var/www/niochat/backend/media
STATIC_ROOT=/var/www/niochat/backend/static

# CORS Settings
CORS_ALLOWED_ORIGINS=https://app.niochat.com.br,https://admin.niochat.com.br,https://api.niochat.com.br
CORS_ALLOW_CREDENTIALS=True
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOW_HEADERS=accept,accept-encoding,authorization,content-type,dnt,origin,user-agent,x-csrftoken,x-requested-with

# Security
CSRF_TRUSTED_ORIGINS=https://app.niochat.com.br,https://admin.niochat.com.br,https://api.niochat.com.br
SECURE_BROWSER_XSS_FILTER=True
SECURE_CONTENT_TYPE_NOSNIFF=True
X_FRAME_OPTIONS=SAMEORIGIN
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=True
SECURE_HSTS_PRELOAD=True

# Logging
LOG_LEVEL=INFO
LOGGING_CONFIG=
LOGGING={
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {process:d} {thread:d} {message}',
            'style': '{',
        },
        'simple': {
            'format': '{levelname} {message}',
            'style': '{',
        },
    },
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': '/var/log/niochat/django.log',
            'formatter': 'verbose',
        },
        'console': {
            'level': 'INFO',
            'class': 'logging.StreamHandler',
            'formatter': 'simple',
        },
    },
    'root': {
        'handlers': ['console', 'file'],
        'level': 'INFO',
    },
    'loggers': {
        'django': {
            'handlers': ['console', 'file'],
            'level': 'INFO',
            'propagate': False,
        },
        'channels': {
            'handlers': ['console', 'file'],
            'level': 'INFO',
            'propagate': False,
        },
    },
}

# Webhook Secret
WEBHOOK_SECRET=niochat_deploy_secret_2024

# OpenAI (ESSENCIAL para IA)
OPENAI_API_KEY=your-openai-api-key-here
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=4000
OPENAI_TEMPERATURE=0.7

# Configurações de IA e Memória
AI_MEMORY_TTL=86400  # 24 horas em segundos
AI_CONVERSATION_HISTORY_LIMIT=50  # Número máximo de mensagens para manter no contexto
AI_SYSTEM_PROMPT=Você é um assistente virtual inteligente e prestativo do NioChat. Mantenha o contexto da conversa e seja útil ao usuário.

# SGP (se necessário)
SGP_APP_TOKEN=your-sgp-token-here
SGP_APP_URL=your-sgp-url-here

# Configurações de Performance
REDIS_CONNECTION_POOL_SIZE=20
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# Channels (WebSocket) - updated to port 6380
CHANNEL_LAYERS={
    'default': {
        'BACKEND': 'channels_redis.core.RedisChannelLayer',
        'CONFIG': {
            'hosts': [{
                'host': '154.38.176.17',
                'port': 6380,
                'password': 'E0sJT3wAYFuahovmHkxgy',
                'db': 0,
            }],
        },
    },
}

# Cache - updated to port 6380
CACHES={
    'default': {
        'BACKEND': 'django.core.cache.backends.redis.RedisCache',
        'LOCATION': 'redis://:E0sJT3wAYFuahovmHkxgy@154.38.176.17:6380/3',
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
        }
    }
}

# Session
SESSION_ENGINE='django.contrib.sessions.backends.cache'
SESSION_CACHE_ALIAS='default'

# Static Files
STATICFILES_STORAGE='django.contrib.staticfiles.storage.StaticFilesStorage'
STATICFILES_FINDERS=[
    'django.contrib.staticfiles.finders.FileSystemFinder',
    'django.contrib.staticfiles.finders.AppDirectoriesFinder',
]

# Media Files
FILE_UPLOAD_MAX_MEMORY_SIZE=10485760  # 10MB
DATA_UPLOAD_MAX_MEMORY_SIZE=10485760  # 10MB

# Time Zone
TIME_ZONE=America/Sao_Paulo
USE_TZ=True

# Language
LANGUAGE_CODE=pt-br
USE_I18N=True
USE_L10N=True

# Admin Site
ADMIN_SITE_HEADER=NioChat Admin
ADMIN_SITE_TITLE=NioChat
ADMIN_INDEX_TITLE=Bem-vindo ao NioChat

# Performance
CONN_MAX_AGE=600
OPTIMIZE_TABLE_QUERIES=True
